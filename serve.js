"use strict";var b=Object.create;var i=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var w=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var P=(e,r)=>{for(var o in r)i(e,o,{get:r[o],enumerable:!0})},d=(e,r,o,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of M(r))!A.call(e,t)&&t!==o&&i(e,t,{get:()=>r[t],enumerable:!(a=y(r,t))||a.enumerable});return e};var u=(e,r,o)=>(o=e!=null?b(w(e)):{},d(r||!e||!e.__esModule?i(o,"default",{value:e,enumerable:!0}):o,e)),B=e=>d(i({},"__esModule",{value:!0}),e);var O={};P(O,{gopoolServe:()=>G});module.exports=B(O);var g=u(require("fastify")),v=u(require("node:os")),h=u(require("piscina")),m=(0,g.default)(),f=v.default.cpus().length,G=async({filename:e,timeout:r=1e4,minThreads:o=0,maxThreads:a=f,maxQueue:t=f*1e3,idleTimeout:x=15e3})=>{try{let s=new h.default({filename:e,env:process.env,idleTimeout:x,minThreads:o,maxThreads:a,maxQueue:t,argv:process.argv}),c=require(e),n=c.default||c,l={};n.onMasterBefroeAll&&await Promise.resolve(n.onMasterBefroeAll({app:m,ctx:l,pool:s}));let T=n.headerGetter;n.useAllRoute({app:m,ctx:l,pool:s,timeout:r,headerGetter:T});let p=n.onMaster;n=void 0,c=void 0,p&&await Promise.resolve(p({app:m,ctx:l,pool:s}))}catch(s){console.error(s),m.log.error(s)}};0&&(module.exports={gopoolServe});
