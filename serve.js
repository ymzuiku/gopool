"use strict";var T=Object.create;var i=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty;var P=(e,r)=>{for(var o in r)i(e,o,{get:r[o],enumerable:!0})},d=(e,r,o,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of w(r))!M.call(e,t)&&t!==o&&i(e,t,{get:()=>r[t],enumerable:!(n=b(r,t))||n.enumerable});return e};var p=(e,r,o)=>(o=e!=null?T(A(e)):{},d(r||!e||!e.__esModule?i(o,"default",{value:e,enumerable:!0}):o,e)),B=e=>d(i({},"__esModule",{value:!0}),e);var O={};P(O,{masterServe:()=>G});module.exports=B(O);var v=p(require("fastify")),g=p(require("node:os")),h=p(require("piscina")),c=(0,v.default)(),f=g.default.cpus().length,G=async({filename:e,timeout:r=1e4,minThreads:o=0,maxThreads:n=f,maxQueue:t=f*1e3,idleTimeout:x=15e3})=>{try{let s=new h.default({filename:e,env:process.env,execArgv:process.execArgv,argv:process.argv,idleTimeout:x,minThreads:o,maxThreads:n,maxQueue:t}),m={},u;await async function(){let l=require(e),a=l.default||l;a.onMasterBefroeAll&&await Promise.resolve(a.onMasterBefroeAll({app:c,ctx:m,pool:s}));let y=a.headerGetter;a.useAllRoute({app:c,ctx:m,pool:s,timeout:r,headerGetter:y}),u=a.onMaster,a=void 0,l=void 0}(),u&&await Promise.resolve(u({app:c,ctx:m,pool:s}))}catch(s){console.error(s),c.log.error(s)}};0&&(module.exports={masterServe});
