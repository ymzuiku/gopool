"use strict";var T=Object.create;var i=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var M=Object.getPrototypeOf,w=Object.prototype.hasOwnProperty;var A=(e,r)=>{for(var o in r)i(e,o,{get:r[o],enumerable:!0})},f=(e,r,o,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of y(r))!w.call(e,t)&&t!==o&&i(e,t,{get:()=>r[t],enumerable:!(a=b(r,t))||a.enumerable});return e};var u=(e,r,o)=>(o=e!=null?T(M(e)):{},f(r||!e||!e.__esModule?i(o,"default",{value:e,enumerable:!0}):o,e)),P=e=>f(i({},"__esModule",{value:!0}),e);var O={};A(O,{gopoolServe:()=>B});module.exports=P(O);var g=u(require("fastify")),v=u(require("node:os")),h=u(require("piscina")),m=(0,g.default)(),d=v.default.cpus().length,B=async({filename:e,timeout:r=1e4,minThreads:o=0,maxThreads:a=d,maxQueue:t=d*1e3,idleTimeout:x=15e3})=>{try{let s=new h.default({filename:e,env:process.env,idleTimeout:x,minThreads:o,maxThreads:a,argv:process.argv}),c=require(e),n=c.default||c,l={};n.onMasterBefroeAll&&await Promise.resolve(n.onMasterBefroeAll({app:m,ctx:l,pool:s})),n.useAllRoute({app:m,ctx:l,pool:s,timeout:r});let p=n.onMaster;n=void 0,c=void 0,p&&await Promise.resolve(p({app:m,ctx:l,pool:s}))}catch(s){console.error(s),m.log.error(s)}};0&&(module.exports={gopoolServe});
