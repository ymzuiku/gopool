"use strict";var p=Object.create;var y=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var E=Object.getPrototypeOf,O=Object.prototype.hasOwnProperty;var P=(e,t)=>{for(var s in t)y(e,s,{get:t[s],enumerable:!0})},l=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of g(t))!O.call(e,a)&&a!==s&&y(e,a,{get:()=>t[a],enumerable:!(r=f(t,a))||r.enumerable});return e};var T=(e,t,s)=>(s=e!=null?p(E(e)):{},l(t||!e||!e.__esModule?y(s,"default",{value:e,enumerable:!0}):s,e)),M=e=>l(y({},"__esModule",{value:!0}),e);var v={};P(v,{gopool:()=>n});module.exports=M(v);var d=T(require("events")),o=[],i={},n=async({uri:e,body:t,ctx:s})=>{let r=i[e];return r?await Promise.resolve(r(t,s)):Error("Not found uri: "+e)};n.all=(e,t)=>{o.push({url:e,method:"ALL"}),i["ALL"+e]=t};n.get=(e,t)=>{o.push({url:e,method:"GET"}),i["GET"+e]=t};n.post=(e,t)=>{o.push({url:e,method:"POST"}),i["POST"+e]=t};n.put=(e,t)=>{o.push({url:e,method:"PUT"}),i["PUT"+e]=t};n.delete=(e,t)=>{o.push({url:e,method:"DELETE"}),i["DELETE"+e]=t};n.options=(e,t)=>{o.push({url:e,method:"OPTIONS"}),i["OPTIONS"+e]=t};n.onMasterBefroeAll=void 0;n.onMaster=void 0;n.useAllRoute=({app:e,pool:t,ctx:s,timeout:r})=>{o.forEach(a=>{a.method==="GET"?e.get(a.url,async({query:u})=>{let c=new d.default,m=setTimeout(()=>{c.emit("abort")},r),h=await t.run({uri:a.method+a.url,body:u,ctx:s},{signal:c});return clearTimeout(m),h}):e[a.method.toLocaleLowerCase()](a.url,async({body:u})=>await t.run({uri:a.method+a.url,body:JSON.parse(u),ctx:s}))})};n.startInWorker=async e=>{let t={};n.onMasterBefroeAll&&await Promise.resolve(n.onMasterBefroeAll({app:e,ctx:t})),o.forEach(s=>{s.method==="GET"?e.get(s.url,async({query:r})=>await n({uri:s.method+s.url,body:r,ctx:t})):e[s.method.toLocaleLowerCase()](s.url,async({body:r})=>await n({uri:s.method+s.url,body:JSON.parse(r),ctx:t}))}),n.onMaster&&await Promise.resolve(n.onMaster({app:e,ctx:t}))};0&&(module.exports={gopool});
